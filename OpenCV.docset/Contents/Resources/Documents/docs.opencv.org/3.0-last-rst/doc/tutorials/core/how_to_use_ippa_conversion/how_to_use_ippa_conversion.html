<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33108845-1']);
  _gaq.push(['_setDomainName', 'opencv.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from docs.opencv.org/3.0-last-rst/doc/tutorials/core/how_to_use_ippa_conversion/how_to_use_ippa_conversion.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 23 Dec 2015 07:01:16 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Intel® IPP Asynchronous C/C++ library in OpenCV</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '3.0.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/insertIframe.js"></script>
    <link rel="top" title="OpenCV 3.0.0-dev documentation" href="../../../../index.html" />
    <link rel="up" title="core module. The Core Functionality" href="../table_of_content_core/table_of_content_core.html" />
    <link rel="next" title="imgproc module. Image Processing" href="../../imgproc/table_of_content_imgproc/table_of_content_imgproc.html" />
    <link rel="prev" title="Interoperability with OpenCV 1" href="../interoperability_with_OpenCV_1/interoperability_with_OpenCV_1.html" />
    <link href='../../../../../../fonts.googleapis.com/css8a7c.css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../imgproc/table_of_content_imgproc/table_of_content_imgproc.html" title="imgproc module. Image Processing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../interoperability_with_OpenCV_1/interoperability_with_OpenCV_1.html" title="Interoperability with OpenCV 1"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../../index.html">OpenCV 3.0.0-dev documentation</a> &raquo;</li>
          <li><a href="../../tutorials.html" >OpenCV Tutorials</a> &raquo;</li>
          <li><a href="../table_of_content_core/table_of_content_core.html" accesskey="U"><em>core</em> module. The Core Functionality</a> &raquo;</li> 
      </ul>
    </div>  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/opencv-logo2.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://docs.opencv.org/3.0-last-rst/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Intel® IPP Asynchronous C/C++ library in OpenCV</a><ul>
<li><a class="reference internal" href="#goal">Goal</a></li>
<li><a class="reference internal" href="#code">Code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
<li><a class="reference internal" href="#result">Result</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../interoperability_with_OpenCV_1/interoperability_with_OpenCV_1.html"
                        title="previous chapter">Interoperability with OpenCV 1</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../imgproc/table_of_content_imgproc/table_of_content_imgproc.html"
                        title="next chapter"><em>imgproc</em> module. Image Processing</a></p>
        </div>
      </div>
  <body>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="intel-ipp-asynchronous-c-c-library-in-opencv">
<span id="howtouseippaconversion"></span><h1>Intel® IPP Asynchronous C/C++ library in OpenCV<a class="headerlink" href="#intel-ipp-asynchronous-c-c-library-in-opencv" title="Permalink to this headline">¶</a></h1>
<div class="section" id="goal">
<h2>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h2>
<p>The tutorial demonstrates the <a class="reference external" href="http://software.intel.com/en-us/intel-ipp-preview">Intel® IPP Asynchronous C/C++</a> library usage with OpenCV.
The code example below illustrates implementation of the Sobel operation, accelerated with Intel® IPP Asynchronous C/C++ functions.
In this code example, <a class="reference external" href="http://docs.opencv.org/modules/core/doc/ipp_async_converters.html#">hpp::getMat</a> and <a class="reference external" href="http://docs.opencv.org/modules/core/doc/ipp_async_converters.html#">hpp::getHpp</a> functions are used for data conversion between <a class="reference external" href="http://software.intel.com/en-us/node/501660">hppiMatrix</a> and <tt class="docutils literal"><span class="pre">Mat</span></tt> matrices.</p>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>You may also find the source code in the <tt class="file docutils literal"><span class="pre">samples/cpp/tutorial_code/core/ippasync/ippasync_sample.cpp</span></tt>
file of the OpenCV source library or <a class="reference download internal" href="../../../../_downloads/ippasync_sample.cpp"><tt class="xref download docutils literal"><span class="pre">download</span> <span class="pre">it</span> <span class="pre">from</span> <span class="pre">here</span></tt></a>.</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>

<span class="cp">#include &quot;opencv2/core/utility.hpp&quot;</span>
<span class="cp">#include &quot;opencv2/imgproc.hpp&quot;</span>
<span class="cp">#include &quot;opencv2/highgui.hpp&quot;</span>
<span class="cp">#include &quot;cvconfig.h&quot;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>

<span class="cp">#ifdef HAVE_IPP_A</span>
<span class="cp">#include &quot;opencv2/core/ippasync.hpp&quot;</span>

<span class="cp">#define CHECK_STATUS(STATUS, NAME)\</span>
<span class="cp">    if(STATUS!=HPP_STATUS_NO_ERROR){ printf(&quot;%s error %d\n&quot;, NAME, STATUS);\</span>
<span class="cp">    if (virtMatrix) {hppStatus delSts = hppiDeleteVirtualMatrices(accel, virtMatrix); CHECK_DEL_STATUS(delSts,&quot;hppiDeleteVirtualMatrices&quot;);}\</span>
<span class="cp">    if (accel)      {hppStatus delSts = hppDeleteInstance(accel); CHECK_DEL_STATUS(delSts, &quot;hppDeleteInstance&quot;);}\</span>
<span class="cp">    return -1;}</span>

<span class="cp">#define CHECK_DEL_STATUS(STATUS, NAME)\</span>
<span class="cp">    if(STATUS!=HPP_STATUS_NO_ERROR){ printf(&quot;%s error %d\n&quot;, NAME, STATUS); return -1;}</span>

<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">help</span><span class="p">()</span>
<span class="p">{</span>
 <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This program shows how to use the conversion for IPP Async.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;This example uses the Sobel filter.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;You can use cv::Sobel or hppiSobel.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Usage: </span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;./ipp_async_sobel [--camera]=&lt;use camera,if this key is present&gt;, </span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;                  [--file_name]=&lt;path to movie or image file&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;                  [--accel]=&lt;accelerator type: auto (default), cpu, gpu&gt;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">keys</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="s">&quot;{c  camera   |           | use camera or not}&quot;</span>
    <span class="s">&quot;{fn file_name|../data/baboon.jpg | image file       }&quot;</span>
    <span class="s">&quot;{a accel     |auto       | accelerator type: auto (default), cpu, gpu}&quot;</span>
<span class="p">};</span>

<span class="c1">//this is a sample for hppiSobel functions</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">help</span><span class="p">();</span>

    <span class="n">VideoCapture</span> <span class="n">cap</span><span class="p">;</span>
    <span class="n">CommandLineParser</span> <span class="n">parser</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">keys</span><span class="p">);</span>
    <span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">result</span><span class="p">;</span>

<span class="cp">#ifdef HAVE_IPP_A</span>

    <span class="n">hppiMatrix</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span><span class="o">*</span> <span class="n">dst</span><span class="p">;</span>
    <span class="n">hppAccel</span> <span class="n">accel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">hppAccelType</span> <span class="n">accelType</span><span class="p">;</span>
    <span class="n">hppStatus</span> <span class="n">sts</span><span class="p">;</span>
    <span class="n">hppiVirtualMatrix</span> <span class="o">*</span> <span class="n">virtMatrix</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">useCamera</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;camera&quot;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">file</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;file_name&quot;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">sAccel</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;accel&quot;</span><span class="p">);</span>

    <span class="n">parser</span><span class="p">.</span><span class="n">printMessage</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">useCamera</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;used camera</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">cap</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;used image %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">cap</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;can not open camera or video file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">accelType</span> <span class="o">=</span> <span class="n">sAccel</span> <span class="o">==</span> <span class="s">&quot;cpu&quot;</span> <span class="o">?</span> <span class="n">HPP_ACCEL_TYPE_CPU</span><span class="o">:</span>
                <span class="n">sAccel</span> <span class="o">==</span> <span class="s">&quot;gpu&quot;</span> <span class="o">?</span> <span class="n">HPP_ACCEL_TYPE_GPU</span><span class="o">:</span>
                                  <span class="n">HPP_ACCEL_TYPE_ANY</span><span class="p">;</span>

    <span class="c1">//Create accelerator instance</span>
    <span class="n">sts</span> <span class="o">=</span> <span class="n">hppCreateInstance</span><span class="p">(</span><span class="n">accelType</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">accel</span><span class="p">);</span>
    <span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="s">&quot;hppCreateInstance&quot;</span><span class="p">);</span>

    <span class="n">accelType</span> <span class="o">=</span> <span class="n">hppQueryAccelType</span><span class="p">(</span><span class="n">accel</span><span class="p">);</span>

    <span class="n">sAccel</span> <span class="o">=</span> <span class="n">accelType</span> <span class="o">==</span> <span class="n">HPP_ACCEL_TYPE_CPU</span> <span class="o">?</span> <span class="s">&quot;cpu&quot;</span><span class="o">:</span>
             <span class="n">accelType</span> <span class="o">==</span> <span class="n">HPP_ACCEL_TYPE_GPU</span> <span class="o">?</span> <span class="s">&quot;gpu&quot;</span><span class="o">:</span>
             <span class="n">accelType</span> <span class="o">==</span> <span class="n">HPP_ACCEL_TYPE_GPU_VIA_DX9</span> <span class="o">?</span> <span class="s">&quot;gpu dx9&quot;</span><span class="o">:</span> <span class="s">&quot;?&quot;</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;accelType %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sAccel</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="n">virtMatrix</span> <span class="o">=</span> <span class="n">hppiCreateVirtualMatrices</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(;;)</span>
    <span class="p">{</span>
        <span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">image</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="n">cvtColor</span><span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">COLOR_BGR2GRAY</span> <span class="p">);</span>

        <span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>

        <span class="kt">double</span> <span class="n">execTime</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">getTickCount</span><span class="p">();</span>

        <span class="c1">//convert Mat to hppiMatrix</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">hpp</span><span class="o">::</span><span class="n">getHpp</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span><span class="n">accel</span><span class="p">);</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">hpp</span><span class="o">::</span><span class="n">getHpp</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">accel</span><span class="p">);</span>

        <span class="n">sts</span> <span class="o">=</span> <span class="n">hppiSobel</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span><span class="n">src</span><span class="p">,</span> <span class="n">HPP_MASK_SIZE_3X3</span><span class="p">,</span><span class="n">HPP_NORM_L1</span><span class="p">,</span><span class="n">virtMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiSobel&quot;</span><span class="p">);</span>

        <span class="n">sts</span> <span class="o">=</span> <span class="n">hppiConvert</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">virtMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HPP_RND_MODE_NEAR</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">HPP_DATA_TYPE_8U</span><span class="p">);</span>
        <span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiConvert&quot;</span><span class="p">);</span>

        <span class="c1">// Wait for tasks to complete</span>
        <span class="n">sts</span> <span class="o">=</span> <span class="n">hppWait</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">HPP_TIME_OUT_INFINITE</span><span class="p">);</span>
        <span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="s">&quot;hppWait&quot;</span><span class="p">);</span>

        <span class="n">execTime</span> <span class="o">=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">getTickCount</span><span class="p">()</span> <span class="o">-</span> <span class="n">execTime</span><span class="p">)</span><span class="o">*</span><span class="mf">1000.</span><span class="o">/</span><span class="n">getTickFrequency</span><span class="p">();</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Time : %0.3fms</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">execTime</span><span class="p">);</span>

        <span class="n">imshow</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
        <span class="n">imshow</span><span class="p">(</span><span class="s">&quot;rez&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>

        <span class="n">waitKey</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

        <span class="n">sts</span> <span class="o">=</span>  <span class="n">hppiFreeMatrix</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
        <span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiFreeMatrix&quot;</span><span class="p">);</span>

        <span class="n">sts</span> <span class="o">=</span>  <span class="n">hppiFreeMatrix</span><span class="p">(</span><span class="n">dst</span><span class="p">);</span>
        <span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiFreeMatrix&quot;</span><span class="p">);</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">useCamera</span><span class="p">)</span>
        <span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">virtMatrix</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sts</span> <span class="o">=</span> <span class="n">hppiDeleteVirtualMatrices</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">virtMatrix</span><span class="p">);</span>
        <span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiDeleteVirtualMatrices&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">accel</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sts</span> <span class="o">=</span> <span class="n">hppDeleteInstance</span><span class="p">(</span><span class="n">accel</span><span class="p">);</span>
        <span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="s">&quot;hppDeleteInstance&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;SUCCESS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="cp">#else</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;IPP Async not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="cp">#endif</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Create parameters for OpenCV:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">VideoCapture</span> <span class="n">cap</span><span class="p">;</span>
<span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
<p>and IPP Async:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">hppiMatrix</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span><span class="o">*</span> <span class="n">dst</span><span class="p">;</span>
<span class="n">hppAccel</span> <span class="n">accel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">hppAccelType</span> <span class="n">accelType</span><span class="p">;</span>
<span class="n">hppStatus</span> <span class="n">sts</span><span class="p">;</span>
<span class="n">hppiVirtualMatrix</span> <span class="o">*</span> <span class="n">virtMatrix</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Load input image or video. How to open and read video stream you can see in the <a class="reference internal" href="../../highgui/video-input-psnr-ssim/video-input-psnr-ssim.html#videoinputpsnrmssim"><em>Video Input with OpenCV and similarity measurement</em></a> tutorial.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span> <span class="n">useCamera</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;used camera</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="n">cap</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;used image %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
   <span class="n">cap</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;can not open camera or video file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Create accelerator instance using <a class="reference external" href="http://software.intel.com/en-us/node/501686">hppCreateInstance</a>:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">accelType</span> <span class="o">=</span> <span class="n">sAccel</span> <span class="o">==</span> <span class="s">&quot;cpu&quot;</span> <span class="o">?</span> <span class="n">HPP_ACCEL_TYPE_CPU</span><span class="o">:</span>
            <span class="n">sAccel</span> <span class="o">==</span> <span class="s">&quot;gpu&quot;</span> <span class="o">?</span> <span class="n">HPP_ACCEL_TYPE_GPU</span><span class="o">:</span>
                              <span class="n">HPP_ACCEL_TYPE_ANY</span><span class="p">;</span>

<span class="c1">//Create accelerator instance</span>
<span class="n">sts</span> <span class="o">=</span> <span class="n">hppCreateInstance</span><span class="p">(</span><span class="n">accelType</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">accel</span><span class="p">);</span>
<span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="s">&quot;hppCreateInstance&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Create an array of virtual matrices using <a class="reference external" href="http://software.intel.com/en-us/node/501700">hppiCreateVirtualMatrices</a> function.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">virtMatrix</span> <span class="o">=</span> <span class="n">hppiCreateVirtualMatrices</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Prepare a matrix for input and output data:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">image</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
   <span class="k">break</span><span class="p">;</span>

<span class="n">cvtColor</span><span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">COLOR_BGR2GRAY</span> <span class="p">);</span>

<span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Convert <tt class="docutils literal"><span class="pre">Mat</span></tt> to <a class="reference external" href="http://software.intel.com/en-us/node/501660">hppiMatrix</a> using <a class="reference external" href="http://docs.opencv.org/modules/core/doc/ipp_async_converters.html#">getHpp</a> and call <a class="reference external" href="http://software.intel.com/en-us/node/474701">hppiSobel</a> function.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//convert Mat to hppiMatrix</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">getHpp</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">accel</span><span class="p">);</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">getHpp</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">accel</span><span class="p">);</span>

<span class="n">sts</span> <span class="o">=</span> <span class="n">hppiSobel</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span><span class="n">src</span><span class="p">,</span> <span class="n">HPP_MASK_SIZE_3X3</span><span class="p">,</span><span class="n">HPP_NORM_L1</span><span class="p">,</span><span class="n">virtMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiSobel&quot;</span><span class="p">);</span>

<span class="n">sts</span> <span class="o">=</span> <span class="n">hppiConvert</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">virtMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HPP_RND_MODE_NEAR</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">HPP_DATA_TYPE_8U</span><span class="p">);</span>
<span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiConvert&quot;</span><span class="p">);</span>

<span class="c1">// Wait for tasks to complete</span>
<span class="n">sts</span> <span class="o">=</span> <span class="n">hppWait</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">HPP_TIME_OUT_INFINITE</span><span class="p">);</span>
<span class="n">CHECK_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="s">&quot;hppWait&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>We use <a class="reference external" href="http://software.intel.com/en-us/node/501746">hppiConvert</a> because <a class="reference external" href="http://software.intel.com/en-us/node/474701">hppiSobel</a> returns destination
matrix with <tt class="docutils literal"><span class="pre">HPP_DATA_TYPE_16S</span></tt> data type for source matrix with <tt class="docutils literal"><span class="pre">HPP_DATA_TYPE_8U</span></tt> type.
You should check <tt class="docutils literal"><span class="pre">hppStatus</span></tt> after each call IPP Async function.</p>
</li>
<li><p class="first">Create windows and show the images, the usual way.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="s">&quot;rez&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>

<span class="n">waitKey</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Delete hpp matrices.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">sts</span> <span class="o">=</span>  <span class="n">hppiFreeMatrix</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
<span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiFreeMatrix&quot;</span><span class="p">);</span>

<span class="n">sts</span> <span class="o">=</span>  <span class="n">hppiFreeMatrix</span><span class="p">(</span><span class="n">dst</span><span class="p">);</span>
<span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiFreeMatrix&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">Delete virtual matrices and accelerator instance.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">virtMatrix</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">sts</span> <span class="o">=</span> <span class="n">hppiDeleteVirtualMatrices</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">virtMatrix</span><span class="p">);</span>
   <span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span><span class="s">&quot;hppiDeleteVirtualMatrices&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">accel</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">sts</span> <span class="o">=</span> <span class="n">hppDeleteInstance</span><span class="p">(</span><span class="n">accel</span><span class="p">);</span>
   <span class="n">CHECK_DEL_STATUS</span><span class="p">(</span><span class="n">sts</span><span class="p">,</span> <span class="s">&quot;hppDeleteInstance&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="result">
<h2>Result<a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h2>
<p>After compiling the code above we can execute it giving an image or video path and accelerator type as an argument.
For this tutorial we use baboon.png image as input. The result is below.</p>
<blockquote>
<div><img alt="Final Result" class="align-center" src="../../../../_images/How_To_Use_IPPA_Result.jpg" />
</div></blockquote>
</div>
</div>


          </div>
          <div class="feedback">
              <h2>Help and Feedback</h2>
              You did not find what you were looking for?
              <ul>
                  
                  
                  
                  <li>Ask a question on the <a href="http://answers.opencv.org/">Q&A forum</a>.</li>
                  <li>If you think something is missing or wrong in the documentation,
                  please file a <a href="http://code.opencv.org/">bug report</a>.</li>
              </ul>
          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../imgproc/table_of_content_imgproc/table_of_content_imgproc.html" title="imgproc module. Image Processing"
             >next</a> |</li>
        <li class="right" >
          <a href="../interoperability_with_OpenCV_1/interoperability_with_OpenCV_1.html" title="Interoperability with OpenCV 1"
             >previous</a> |</li>
        <li><a href="../../../../index.html">OpenCV 3.0.0-dev documentation</a> &raquo;</li>
          <li><a href="../../tutorials.html" >OpenCV Tutorials</a> &raquo;</li>
          <li><a href="../table_of_content_core/table_of_content_core.html" ><em>core</em> module. The Core Functionality</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014, opencv dev team.
      Last updated on Dec 30, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
      <a href="../../../../_sources/doc/tutorials/core/how_to_use_ippa_conversion/how_to_use_ippa_conversion.txt" rel="nofollow">Show this page source.</a>
    </div>
  </body>

<!-- Mirrored from docs.opencv.org/3.0-last-rst/doc/tutorials/core/how_to_use_ippa_conversion/how_to_use_ippa_conversion.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 23 Dec 2015 07:01:16 GMT -->
</html>