<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33108845-1']);
  _gaq.push(['_setDomainName', 'opencv.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from docs.opencv.org/3.0-last-rst/doc/tutorials/features2d/akaze_tracking/akaze_tracking.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 23 Dec 2015 07:06:08 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>AKAZE and ORB planar tracking</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '3.0.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/insertIframe.js"></script>
    <link rel="top" title="OpenCV 3.0.0-dev documentation" href="../../../../index.html" />
    <link rel="up" title="feature2d module. 2D Features framework" href="../table_of_content_features2d/table_of_content_features2d.html" />
    <link rel="next" title="video module. Video analysis" href="../../video/table_of_content_video/table_of_content_video.html" />
    <link rel="prev" title="AKAZE local features matching" href="../akaze_matching/akaze_matching.html" />
    <link href='../../../../../../fonts.googleapis.com/css8a7c.css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../video/table_of_content_video/table_of_content_video.html" title="video module. Video analysis"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../akaze_matching/akaze_matching.html" title="AKAZE local features matching"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../../index.html">OpenCV 3.0.0-dev documentation</a> &raquo;</li>
          <li><a href="../../tutorials.html" >OpenCV Tutorials</a> &raquo;</li>
          <li><a href="../table_of_content_features2d/table_of_content_features2d.html" accesskey="U"><em>feature2d</em> module. 2D Features framework</a> &raquo;</li> 
      </ul>
    </div>  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/opencv-logo2.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://docs.opencv.org/3.0-last-rst/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">AKAZE and ORB planar tracking</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#source-code">Source Code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tracker-class">Tracker class</a><ul>
<li><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../akaze_matching/akaze_matching.html"
                        title="previous chapter">AKAZE local features matching</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../video/table_of_content_video/table_of_content_video.html"
                        title="next chapter"><em>video</em> module. Video analysis</a></p>
        </div>
      </div>
  <body>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="akaze-and-orb-planar-tracking">
<span id="akazetracking"></span><h1>AKAZE and ORB planar tracking<a class="headerlink" href="#akaze-and-orb-planar-tracking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we will compare <em>AKAZE</em> and <em>ORB</em> local features
using them to find matches between video frames and track object movements.</p>
<p>The algorithm is as follows:</p>
<ul class="simple">
<li>Detect and describe keypoints on the first frame, manually set object boundaries</li>
<li>For every next frame:<ol class="arabic">
<li>Detect and describe keypoints</li>
<li>Match them using bruteforce matcher</li>
<li>Estimate homography transformation using RANSAC</li>
<li>Filter inliers from all the matches</li>
<li>Apply homography transformation to the bounding box to find the object</li>
<li>Draw bounding box and inliers, compute inlier ratio as evaluation metric</li>
</ol>
</li>
</ul>
<a class="reference internal image-reference" href="../../../../_images/frame.png"><img alt="Result frame example" class="align-center" src="../../../../_images/frame.png" style="width: 640pt; height: 480pt;" /></a>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>To do the tracking we need a video and object position on the first frame.</p>
<p>You can download our example video and data from <a class="reference external" href="https://docs.google.com/file/d/0B72G7D4snftJandBb0taLVJHMFk">here</a>.</p>
<p>To run the code you have to specify input and output video path and object bounding box.</p>
<div class="highlight-none"><div class="highlight"><pre>./planar_tracking blais.mp4 result.avi blais_bb.xml.gz
</pre></div>
</div>
</div>
<div class="section" id="source-code">
<h3>Source Code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;opencv2/features2d.hpp&gt;</span>
<span class="cp">#include &lt;opencv2/videoio.hpp&gt;</span>
<span class="cp">#include &lt;opencv2/opencv.hpp&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &lt;iomanip&gt;</span>

<span class="cp">#include &quot;stats.h&quot; </span><span class="c1">// Stats structure definition</span>
<span class="cp">#include &quot;utils.h&quot; </span><span class="c1">// Drawing and printing functions</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">akaze_thresh</span> <span class="o">=</span> <span class="mf">3e-4</span><span class="p">;</span> <span class="c1">// AKAZE detection threshold set to locate about 1000 keypoints</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">ransac_thresh</span> <span class="o">=</span> <span class="mf">2.5f</span><span class="p">;</span> <span class="c1">// RANSAC inlier threshold</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">nn_match_ratio</span> <span class="o">=</span> <span class="mf">0.8f</span><span class="p">;</span> <span class="c1">// Nearest-neighbour matching ratio</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">bb_min_inliers</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// Minimal number of inliers to draw bounding box</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">stats_update_period</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// On-screen statistics are updated every 10 frames</span>

<span class="k">class</span> <span class="nc">Tracker</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Tracker</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Feature2D</span><span class="o">&gt;</span> <span class="n">_detector</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DescriptorMatcher</span><span class="o">&gt;</span> <span class="n">_matcher</span><span class="p">)</span> <span class="o">:</span>
        <span class="n">detector</span><span class="p">(</span><span class="n">_detector</span><span class="p">),</span>
        <span class="n">matcher</span><span class="p">(</span><span class="n">_matcher</span><span class="p">)</span>
    <span class="p">{}</span>

    <span class="kt">void</span> <span class="n">setFirstFrame</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="n">frame</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">string</span> <span class="n">title</span><span class="p">,</span> <span class="n">Stats</span><span class="o">&amp;</span> <span class="n">stats</span><span class="p">);</span>
    <span class="n">Mat</span> <span class="nf">process</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="n">frame</span><span class="p">,</span> <span class="n">Stats</span><span class="o">&amp;</span> <span class="n">stats</span><span class="p">);</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Feature2D</span><span class="o">&gt;</span> <span class="n">getDetector</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">detector</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">protected:</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Feature2D</span><span class="o">&gt;</span> <span class="n">detector</span><span class="p">;</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DescriptorMatcher</span><span class="o">&gt;</span> <span class="n">matcher</span><span class="p">;</span>
    <span class="n">Mat</span> <span class="n">first_frame</span><span class="p">,</span> <span class="n">first_desc</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="n">first_kp</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">object_bb</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">Tracker</span><span class="o">::</span><span class="n">setFirstFrame</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="n">frame</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">string</span> <span class="n">title</span><span class="p">,</span> <span class="n">Stats</span><span class="o">&amp;</span> <span class="n">stats</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">first_frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
    <span class="n">detector</span><span class="o">-&gt;</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">noArray</span><span class="p">(),</span> <span class="n">first_kp</span><span class="p">,</span> <span class="n">first_desc</span><span class="p">);</span>
    <span class="n">stats</span><span class="p">.</span><span class="n">keypoints</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">first_kp</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">drawBoundingBox</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">bb</span><span class="p">);</span>
    <span class="n">putText</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">FONT_HERSHEY_PLAIN</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Scalar</span><span class="o">::</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">object_bb</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Mat</span> <span class="n">Tracker</span><span class="o">::</span><span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="n">frame</span><span class="p">,</span> <span class="n">Stats</span><span class="o">&amp;</span> <span class="n">stats</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="n">kp</span><span class="p">;</span>
    <span class="n">Mat</span> <span class="n">desc</span><span class="p">;</span>
    <span class="n">detector</span><span class="o">-&gt;</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">noArray</span><span class="p">(),</span> <span class="n">kp</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
    <span class="n">stats</span><span class="p">.</span><span class="n">keypoints</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">kp</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

    <span class="n">vector</span><span class="o">&lt;</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matches</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="n">matched1</span><span class="p">,</span> <span class="n">matched2</span><span class="p">;</span>
    <span class="n">matcher</span><span class="o">-&gt;</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">first_desc</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">matches</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">nn_match_ratio</span> <span class="o">*</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">].</span><span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">matched1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">first_kp</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">queryIdx</span><span class="p">]);</span>
            <span class="n">matched2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>      <span class="n">kp</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">trainIdx</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">stats</span><span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">matched1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

    <span class="n">Mat</span> <span class="n">inlier_mask</span><span class="p">,</span> <span class="n">homography</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="n">inliers1</span><span class="p">,</span> <span class="n">inliers2</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">inlier_matches</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">matched1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">homography</span> <span class="o">=</span> <span class="n">findHomography</span><span class="p">(</span><span class="n">Points</span><span class="p">(</span><span class="n">matched1</span><span class="p">),</span> <span class="n">Points</span><span class="p">(</span><span class="n">matched2</span><span class="p">),</span>
                                    <span class="n">RANSAC</span><span class="p">,</span> <span class="n">ransac_thresh</span><span class="p">,</span> <span class="n">inlier_mask</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">matched1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">||</span> <span class="n">homography</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">Mat</span> <span class="n">res</span><span class="p">;</span>
        <span class="n">hconcat</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
        <span class="n">stats</span><span class="p">.</span><span class="n">inliers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">stats</span><span class="p">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">matched1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">inlier_mask</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">new_i</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inliers1</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
            <span class="n">inliers1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">matched1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">inliers2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">matched2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">inlier_matches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">DMatch</span><span class="p">(</span><span class="n">new_i</span><span class="p">,</span> <span class="n">new_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">stats</span><span class="p">.</span><span class="n">inliers</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">inliers1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">stats</span><span class="p">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="n">stats</span><span class="p">.</span><span class="n">inliers</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">stats</span><span class="p">.</span><span class="n">matches</span><span class="p">;</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">new_bb</span><span class="p">;</span>
    <span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">object_bb</span><span class="p">,</span> <span class="n">new_bb</span><span class="p">,</span> <span class="n">homography</span><span class="p">);</span>
    <span class="n">Mat</span> <span class="n">frame_with_bb</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">inliers</span> <span class="o">&gt;=</span> <span class="n">bb_min_inliers</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">drawBoundingBox</span><span class="p">(</span><span class="n">frame_with_bb</span><span class="p">,</span> <span class="n">new_bb</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Mat</span> <span class="n">res</span><span class="p">;</span>
    <span class="n">drawMatches</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">inliers1</span><span class="p">,</span> <span class="n">frame_with_bb</span><span class="p">,</span> <span class="n">inliers2</span><span class="p">,</span>
                <span class="n">inlier_matches</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span>
                <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Usage: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span>
                <span class="s">&quot;akaze_track input_path output_path bounding_box&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">VideoCapture</span> <span class="n">video_in</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">VideoWriter</span>  <span class="nf">video_out</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                           <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">video_in</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CAP_PROP_FOURCC</span><span class="p">),</span>
                           <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">video_in</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CAP_PROP_FPS</span><span class="p">),</span>
                           <span class="n">Size</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">video_in</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">),</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">video_in</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">)));</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">video_in</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t open &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">video_out</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t open &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">bb</span><span class="p">;</span>
    <span class="n">FileStorage</span> <span class="nf">fs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">FileStorage</span><span class="o">::</span><span class="n">READ</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="p">[</span><span class="s">&quot;bounding_box&quot;</span><span class="p">].</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Couldn&#39;t read bounding_box from &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">fs</span><span class="p">[</span><span class="s">&quot;bounding_box&quot;</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">bb</span><span class="p">;</span>

    <span class="n">Stats</span> <span class="n">stats</span><span class="p">,</span> <span class="n">akaze_stats</span><span class="p">,</span> <span class="n">orb_stats</span><span class="p">;</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">AKAZE</span><span class="o">&gt;</span> <span class="n">akaze</span> <span class="o">=</span> <span class="n">AKAZE</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
    <span class="n">akaze</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;threshold&quot;</span><span class="p">,</span> <span class="n">akaze_thresh</span><span class="p">);</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ORB</span><span class="o">&gt;</span> <span class="n">orb</span> <span class="o">=</span> <span class="n">ORB</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
    <span class="n">orb</span><span class="o">-&gt;</span><span class="n">setMaxFeatures</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">keypoints</span><span class="p">);</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DescriptorMatcher</span><span class="o">&gt;</span> <span class="n">matcher</span> <span class="o">=</span> <span class="n">DescriptorMatcher</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;BruteForce-Hamming&quot;</span><span class="p">);</span>
    <span class="n">Tracker</span> <span class="nf">akaze_tracker</span><span class="p">(</span><span class="n">akaze</span><span class="p">,</span> <span class="n">matcher</span><span class="p">);</span>
    <span class="n">Tracker</span> <span class="nf">orb_tracker</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span> <span class="n">matcher</span><span class="p">);</span>

    <span class="n">Mat</span> <span class="n">frame</span><span class="p">;</span>
    <span class="n">video_in</span> <span class="o">&gt;&gt;</span> <span class="n">frame</span><span class="p">;</span>
    <span class="n">akaze_tracker</span><span class="p">.</span><span class="n">setFirstFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="s">&quot;AKAZE&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">);</span>
    <span class="n">orb_tracker</span><span class="p">.</span><span class="n">setFirstFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="s">&quot;ORB&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">);</span>

    <span class="n">Stats</span> <span class="n">akaze_draw_stats</span><span class="p">,</span> <span class="n">orb_draw_stats</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">frame_count</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">video_in</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">);</span>
    <span class="n">Mat</span> <span class="n">akaze_res</span><span class="p">,</span> <span class="n">orb_res</span><span class="p">,</span> <span class="n">res_frame</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">frame_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">update_stats</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">stats_update_period</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">video_in</span> <span class="o">&gt;&gt;</span> <span class="n">frame</span><span class="p">;</span>

        <span class="n">akaze_res</span> <span class="o">=</span> <span class="n">akaze_tracker</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">stats</span><span class="p">);</span>
        <span class="n">akaze_stats</span> <span class="o">+=</span> <span class="n">stats</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">update_stats</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">akaze_draw_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">orb_tracker</span><span class="p">.</span><span class="n">getDetector</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;nFeatures&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">.</span><span class="n">keypoints</span><span class="p">);</span>
        <span class="n">orb_res</span> <span class="o">=</span> <span class="n">orb_tracker</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">stats</span><span class="p">);</span>
        <span class="n">orb_stats</span> <span class="o">+=</span> <span class="n">stats</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">update_stats</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orb_draw_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">drawStatistics</span><span class="p">(</span><span class="n">akaze_res</span><span class="p">,</span> <span class="n">akaze_draw_stats</span><span class="p">);</span>
        <span class="n">drawStatistics</span><span class="p">(</span><span class="n">orb_res</span><span class="p">,</span> <span class="n">orb_draw_stats</span><span class="p">);</span>
        <span class="n">vconcat</span><span class="p">(</span><span class="n">akaze_res</span><span class="p">,</span> <span class="n">orb_res</span><span class="p">,</span> <span class="n">res_frame</span><span class="p">);</span>
        <span class="n">video_out</span> <span class="o">&lt;&lt;</span> <span class="n">res_frame</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;/&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">frame_count</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">akaze_stats</span> <span class="o">/=</span> <span class="n">frame_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">orb_stats</span> <span class="o">/=</span> <span class="n">frame_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">printStatistics</span><span class="p">(</span><span class="s">&quot;AKAZE&quot;</span><span class="p">,</span> <span class="n">akaze_stats</span><span class="p">);</span>
    <span class="n">printStatistics</span><span class="p">(</span><span class="s">&quot;ORB&quot;</span><span class="p">,</span> <span class="n">orb_stats</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="explanation">
<h3>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="tracker-class">
<h2>Tracker class<a class="headerlink" href="#tracker-class" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>This class implements algorithm described abobve
using given feature detector and descriptor matcher.</div></blockquote>
<ul>
<li><p class="first"><strong>Setting up the first frame</strong></p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="kt">void</span> <span class="n">Tracker</span><span class="o">::</span><span class="n">setFirstFrame</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="n">frame</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">bb</span><span class="p">,</span> <span class="n">string</span> <span class="n">title</span><span class="p">,</span> <span class="n">Stats</span><span class="o">&amp;</span> <span class="n">stats</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">first_frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
    <span class="p">(</span><span class="o">*</span><span class="n">detector</span><span class="p">)(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">noArray</span><span class="p">(),</span> <span class="n">first_kp</span><span class="p">,</span> <span class="n">first_desc</span><span class="p">);</span>
    <span class="n">stats</span><span class="p">.</span><span class="n">keypoints</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">first_kp</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">drawBoundingBox</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">bb</span><span class="p">);</span>
    <span class="n">putText</span><span class="p">(</span><span class="n">first_frame</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">FONT_HERSHEY_PLAIN</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Scalar</span><span class="o">::</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">object_bb</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We compute and store keypoints and descriptors from the first frame and prepare it for the output.</p>
<p>We need to save number of detected keypoints to make sure both detectors locate roughly the same number of those.</p>
</li>
<li><p class="first"><strong>Processing frames</strong></p>
<ol class="arabic simple">
<li>Locate keypoints and compute descriptors</li>
</ol>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span class="p">(</span><span class="o">*</span><span class="n">detector</span><span class="p">)(</span><span class="n">frame</span><span class="p">,</span> <span class="n">noArray</span><span class="p">(),</span> <span class="n">kp</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
</pre></div>
</div>
<p>To find matches between frames we have to locate the keypoints first.</p>
<p>In this tutorial detectors are set up to find about 1000 keypoints on each frame.</p>
</div></blockquote>
<ol class="arabic simple">
<li>Use 2-nn matcher to find correspondences</li>
</ol>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span class="n">matcher</span><span class="o">-&gt;</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">first_desc</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">matches</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">nn_match_ratio</span> <span class="o">*</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">].</span><span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">matched1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">first_kp</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">queryIdx</span><span class="p">]);</span>
        <span class="n">matched2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>      <span class="n">kp</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">trainIdx</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the closest match is <em>nn_match_ratio</em> closer than the second closest one, then it&#8217;s a match.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Use <em>RANSAC</em> to estimate homography transformation</li>
</ol>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span class="n">homography</span> <span class="o">=</span> <span class="n">findHomography</span><span class="p">(</span><span class="n">Points</span><span class="p">(</span><span class="n">matched1</span><span class="p">),</span> <span class="n">Points</span><span class="p">(</span><span class="n">matched2</span><span class="p">),</span>
                            <span class="n">RANSAC</span><span class="p">,</span> <span class="n">ransac_thresh</span><span class="p">,</span> <span class="n">inlier_mask</span><span class="p">);</span>
</pre></div>
</div>
<p>If there are at least 4 matches we can use random sample consensus to estimate image transformation.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Save the inliers</li>
</ol>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">matched1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">inlier_mask</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">new_i</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inliers1</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
        <span class="n">inliers1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">matched1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">inliers2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">matched2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">inlier_matches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">DMatch</span><span class="p">(</span><span class="n">new_i</span><span class="p">,</span> <span class="n">new_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since <em>findHomography</em> computes the inliers we only have to save the chosen points and matches.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Project object bounding box</li>
</ol>
<blockquote>
<div><div class="highlight-cpp"><div class="highlight"><pre><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">object_bb</span><span class="p">,</span> <span class="n">new_bb</span><span class="p">,</span> <span class="n">homography</span><span class="p">);</span>
</pre></div>
</div>
<p>If there is a reasonable number of inliers we can use estimated transformation to locate the object.</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h3>
<p>You can watch the resulting <a class="reference external" href="http://www.youtube.com/watch?v=LWY-w8AGGhE">video on youtube</a>.</p>
<p><em>AKAZE</em> statistics:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre>Matches      626
Inliers      410
Inlier ratio 0.58
Keypoints    1117
</pre></div>
</div>
</div></blockquote>
<p><em>ORB</em> statistics:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre>Matches      504
Inliers      319
Inlier ratio 0.56
Keypoints    1112
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


          </div>
          <div class="feedback">
              <h2>Help and Feedback</h2>
              You did not find what you were looking for?
              <ul>
                  
                  
                  
                  <li>Ask a question on the <a href="http://answers.opencv.org/">Q&A forum</a>.</li>
                  <li>If you think something is missing or wrong in the documentation,
                  please file a <a href="http://code.opencv.org/">bug report</a>.</li>
              </ul>
          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../video/table_of_content_video/table_of_content_video.html" title="video module. Video analysis"
             >next</a> |</li>
        <li class="right" >
          <a href="../akaze_matching/akaze_matching.html" title="AKAZE local features matching"
             >previous</a> |</li>
        <li><a href="../../../../index.html">OpenCV 3.0.0-dev documentation</a> &raquo;</li>
          <li><a href="../../tutorials.html" >OpenCV Tutorials</a> &raquo;</li>
          <li><a href="../table_of_content_features2d/table_of_content_features2d.html" ><em>feature2d</em> module. 2D Features framework</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014, opencv dev team.
      Last updated on Dec 30, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
      <a href="../../../../_sources/doc/tutorials/features2d/akaze_tracking/akaze_tracking.txt" rel="nofollow">Show this page source.</a>
    </div>
  </body>

<!-- Mirrored from docs.opencv.org/3.0-last-rst/doc/tutorials/features2d/akaze_tracking/akaze_tracking.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 23 Dec 2015 07:06:08 GMT -->
</html>