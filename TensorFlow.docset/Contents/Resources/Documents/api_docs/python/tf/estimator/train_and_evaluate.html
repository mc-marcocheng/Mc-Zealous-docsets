<!DOCTYPE html><html dir="ltr" lang="en"><head>
<meta content="157101835696-ooapojlodmuabs2do2vuhhnf90bccmoi.apps.googleusercontent.com" name="google-signin-client-id"/>
<meta content="profile email" name="google-signin-scope"/>
<meta content="TensorFlow" property="og:site_name"/>
<meta content="website" property="og:type"/>
<meta content="#ff6f00" name="theme-color"/>
<meta charset="utf-8"/>
<meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link crossorigin="use-credentials" href="_pwa/tensorflow/manifest.json" rel="manifest"/>
<link crossorigin="" href="/www.gstatic.com" rel="preconnect"/>
<link crossorigin="" href="/fonts.gstatic.com" rel="preconnect"/>
<link crossorigin="" href="/fonts.googleapis.com" rel="preconnect"/>
<link href="../../../../main.css" rel="stylesheet"/>

<noscript>

</noscript>
<link href="https://www.gstatic.com/devrel-devsite/prod/v3e2dbdc40e7394635e5230ecc02cb28039ea55a5d72db9939d2fb9fc9e16d0ff/tensorflow/images/favicon.png" rel="shortcut icon"/>
<link href="https://www.gstatic.com/devrel-devsite/prod/v3e2dbdc40e7394635e5230ecc02cb28039ea55a5d72db9939d2fb9fc9e16d0ff/tensorflow/images/apple-touch-icon-180x180.png" rel="apple-touch-icon"/><link href="https://www.tensorflow.org/api_docs/python/tf/estimator/train_and_evaluate" rel="canonical"/><link href="https://www.tensorflow.org/s/opensearch.xml" rel="search" title="TensorFlow" type="application/opensearchdescription+xml"/>
<title>tf.estimator.train_and_evaluate &nbsp;|&nbsp; TensorFlow Core v2.1.0</title>
<meta content="tf.estimator.train_and_evaluate &nbsp;|&nbsp; TensorFlow Core v2.1.0" property="og:title"/>
<meta content="https://www.tensorflow.org/api_docs/python/tf/estimator/train_and_evaluate" property="og:url"/>
<meta content="en" property="og:locale"/>

</head>
<body class="" layout="docs" pending="" theme="tensorflow-theme" type="reference">
<devsite-progress id="app-progress" type="indeterminate"></devsite-progress>
<section class="devsite-wrapper"> <devsite-book-nav scrollbars="">

</devsite-book-nav>
<section id="gc-wrapper">
<main class="devsite-main-content" has-book-nav="" has-toc="" role="main">
<devsite-toc class="devsite-nav"></devsite-toc>
<devsite-content>
<article class="devsite-article">
<article class="devsite-article-inner"><style>
        /* Styles inlined from /site-assets/css/style.css */
/* override theme */
table img {
  max-width: 100%;
}

/* override var element to differentiate color from comment */
var, var code, var span, .prettyprint var span {
  color: #039be5;
}

/* .devsite-terminal virtualenv prompt */
.tfo-terminal-venv::before {
  content: "(venv) $ " !important;
}

/* .devsite-terminal root prompt */
.tfo-terminal-root::before {
  content: "# " !important;
}

/* .devsite-terminal Windows prompt */
.tfo-terminal-windows::before {
  content: "C:\\> " !important;
}

/* .devsite-terminal Windows prompt w/ virtualenv */
.tfo-terminal-windows-venv::before {
  content: "(venv) C:\\> " !important;
}

.tfo-diff-green-one-level + * {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-green + * > * {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-green-list + ul > li:first-of-type {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-red-one-level + * {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

.tfo-diff-red + * > * {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

.tfo-diff-red-list + ul > li:first-of-type {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

devsite-code .tfo-notebook-code-cell-output {
  max-height: 300px;
  overflow: auto;
  background: rgba(255, 247, 237, 1);  /* orange bg to distinguish from input code cells */
}

devsite-code .tfo-notebook-code-cell-output + .devsite-code-buttons-container button {
  background: rgba(255, 247, 237, .7);  /* orange bg to distinguish from input code cells */
}

devsite-code[dark-code] .tfo-notebook-code-cell-output {
  background: rgba(64, 78, 103, 1);  /* medium slate */
}

devsite-code[dark-code] .tfo-notebook-code-cell-output + .devsite-code-buttons-container button {
  background: rgba(64, 78, 103, .7);  /* medium slate */
}

/* override default table styles for notebook buttons */
.devsite-table-wrapper .tfo-notebook-buttons {
  display: inline-block;
  margin-left: 3px;
  width: auto;
}

.tfo-notebook-buttons td {
  padding-left: 0;
  padding-right: 20px;
}

.tfo-notebook-buttons a,
.tfo-notebook-buttons :link,
.tfo-notebook-buttons :visited {
  border-radius: 8px;
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 1px 3px 1px rgba(60, 64, 67, .15);
  color: #202124;
  padding: 12px 24px;
  transition: box-shadow 0.2s;
}

.tfo-notebook-buttons a:hover,
.tfo-notebook-buttons a:focus {
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 2px 6px 2px rgba(60, 64, 67, .15);
}

.tfo-notebook-buttons tr {
  background: 0;
  border: 0;
}

/* on rendered notebook page,
   remove link to webpage since we're already here */
.tfo-notebook-buttons:not(.tfo-api) td:first-child {
  display: none;
}

.tfo-notebook-buttons td > a {
  -webkit-box-align: center;
  -ms-flex-align: center;
  align-items: center;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.tfo-notebook-buttons td > a > img {
  margin-right: 8px;
}

/* landing pages */

.tfo-landing-row-item-inset-white {
  background-color: #fff;
  padding: 32px;
}

.tfo-landing-row-item-inset-white ol,
.tfo-landing-row-item-inset-white ul {
  padding-left: 20px;
}

/* colab callout button */
.colab-callout-row devsite-code {
  border-radius: 8px 8px 0 0;
  box-shadow: none;
}

.colab-callout-footer {
  background: #e3e4e7;
  border-radius: 0 0 8px 8px;
  color: #37474f;
  padding: 20px;
}

.colab-callout-row devsite-code[dark-code] + .colab-callout-footer {
  background: #3f4f66;
}


.colab-callout-footer > .button {
  margin-top: 4px;
  color: #ff5c00;
}

.colab-callout-footer > a > span {
  padding-top: 10px;
  vertical-align: middle;
  color: #37474f;
  padding-left: 10px;
  padding-right: 10px;
  font-size: 14px;
}

.colab-callout-row devsite-code[dark-code] + .colab-callout-footer > a > span {
  color: #fff;
}

a.colab-button {
  background: rgba(255, 255, 255, .75);
  border: solid 1px rgba(0, 0, 0, .08);
  border-bottom-color: rgba(0, 0, 0, .15);
  border-radius: 4px;
  color: #aaa;
  display: inline-block;
  font-size: 11px !important;
  font-weight: 300;
  line-height: 16px;
  padding: 4px 8px;
  text-decoration: none;
  text-transform: uppercase;
}

a.colab-button:hover {
  background: white;
  border-color: rgba(0, 0, 0, .2);
  color: #666;
}

a.colab-button span {
  background: url(/images/colab_logo_button.svg) no-repeat 1px 1px / 20px;
  border-radius: 4px;
  display: inline-block;
  padding-left: 24px;
  text-decoration: none;
}

@media screen and (max-width: 600px) {
  .tfo-notebook-buttons td {
    display: block;
  }
}

/* guide and tutorials landing page cards and sections */

.tfo-landing-page-card {
  padding: 16px;
  box-shadow: 0 0 36px rgba(0,0,0,0.1);
  border-radius: 10px;
}

/* Page section headings */
.tfo-landing-page-heading h2, h2.tfo-landing-page-heading {
  font-family: "Google Sans", sans-serif;
  color: #425066;
  font-size: 30px;
  font-weight: 700;
  line-height: 40px;
}

/* Item title headings */
.tfo-landing-page-heading h3, h3.tfo-landing-page-heading,
.tfo-landing-page-card h3, h3.tfo-landing-page-card {
  font-family: "Google Sans", sans-serif;
  color: #425066;
  font-size: 20px;
  font-weight: 500;
  line-height: 26px;
}

/* List of tutorials notebooks for subsites */
.tfo-landing-page-resources-ul {
  padding-left: 15px
}

.tfo-landing-page-resources-ul > li {
  margin: 6px 0;
}

/* Temporary fix to hide product description in header on landing pages */
devsite-header .devsite-product-description {
  display: none;
}

        </style> <div class="devsite-banner devsite-banner-announcement">
<div class="devsite-banner-message">
<div class="devsite-banner-message-text">
            Missed TensorFlow Dev Summit? Check out the video playlist. <a class="button button-primary button-tfo-announcement" href="https://goo.gle/TFDS20AllSessions">Watch recordings</a>
</div>
</div>
</div>
<div class="devsite-article-meta">
<ul class="devsite-breadcrumb-list">
<li class="devsite-breadcrumb-item">
<a class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="1" href="">
            TensorFlow
      
  </a>
</li>
<li class="devsite-breadcrumb-item">
<div aria-hidden="true" class="devsite-breadcrumb-guillemet material-icons"></div>
<a class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="2" href="api">
            API
      
  </a>
</li>
<li class="devsite-breadcrumb-item">
<div aria-hidden="true" class="devsite-breadcrumb-guillemet material-icons"></div>
<a class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="3" href="api_docs">
            TensorFlow Core v2.1.0
      
  </a>
</li>
<li class="devsite-breadcrumb-item">
<div aria-hidden="true" class="devsite-breadcrumb-guillemet material-icons"></div>
<a class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="4" href="api_docs/python/tf">
            Python
      
  </a>
</li>
</ul>
<devsite-page-rating hover-rating-star="0" position="header" selected-rating="0">
</devsite-page-rating>
</div>
<a class="dashingAutolink" name="autolink-1400"></a><a class="dashAnchor" name="//apple_ref/cpp/Function/tf.estimator.train_and_evaluate"></a><h1 class="dash-function">tf.estimator.train_and_evaluate</h1>
<devsite-toc class="devsite-nav" devsite-toc-embedded="">
</devsite-toc>
<div class="devsite-article-body clearfix">
<p><devsite-mathjax config="TeX-AMS-MML_SVG"></devsite-mathjax>
</p>
<!-- DO NOT EDIT! Automatically generated file. -->
<div itemscope="" itemtype="http://developers.google.com/ReferenceObject">
<meta content="tf.estimator.train_and_evaluate" itemprop="name"/>
<meta content="Stable" itemprop="path"/>
</div>
<!-- Insert buttons and diff -->
<table align="left" class="tfo-notebook-buttons tfo-api">
<tbody><tr><td>
<a href="versions/r1.15/api_docs/python/tf/estimator/train_and_evaluate" target="_blank">
<img src="https://www.tensorflow.org/images/tf_logo_32px.png"/>
  TensorFlow 1 version</a>
</td>
<td>
<a href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/training.py" target="_blank">
<img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png"/>
    View source on GitHub
  </a>
</td></tr></tbody></table>
<p>Train and evaluate the <code dir="ltr" translate="no">estimator</code>.</p>
<section class="expandable">
<h4 class="showalways">View aliases</h4>
<p>
<b>Compat aliases for migration</b>
</p><p>See
<a href="https://www.tensorflow.org/guide/migrate">Migration guide</a> for
more details.</p>
<p><a href="api_docs/python/tf/estimator/train_and_evaluate"><code dir="ltr" translate="no">tf.compat.v1.estimator.train_and_evaluate</code></a></p>
</section>
<pre class="prettyprint lang-python" dir="ltr" translate="no"><code dir="ltr" translate="no">tf.estimator.train_and_evaluate(
    estimator, train_spec, eval_spec
)
</code></pre>
<h3>Used in the notebooks</h3>
<table class="vertical-rules">
<thead>
<tr>
<th>Used in the guide</th>
<th>Used in the tutorials</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<ul>
<li><a href="https://www.tensorflow.org/guide/migrate">Migrate your TensorFlow 1 code to TensorFlow 2</a></li>
</ul>
</td>
<td>
<ul>
<li><a href="https://www.tensorflow.org/tutorials/distribute/multi_worker_with_estimator">Multi-worker training with Estimator</a></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This utility function trains, evaluates, and (optionally) exports the model by
using the given <code dir="ltr" translate="no">estimator</code>. All training related specification is held in
<code dir="ltr" translate="no">train_spec</code>, including training <code dir="ltr" translate="no">input_fn</code> and training max steps, etc. All
evaluation and export related specification is held in <code dir="ltr" translate="no">eval_spec</code>, including
evaluation <code dir="ltr" translate="no">input_fn</code>, steps, etc.</p>
<p>This utility function provides consistent behavior for both local
(non-distributed) and distributed configurations. The default distribution
configuration is parameter server-based between-graph replication. For other
types of distribution configurations such as all-reduce training, please use
<a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/distribute">DistributionStrategies</a>.</p>
<p>Overfitting: In order to avoid overfitting, it is recommended to set up the
training <code dir="ltr" translate="no">input_fn</code> to shuffle the training data properly.</p>
<p>Stop condition: In order to support both distributed and non-distributed
configuration reliably, the only supported stop condition for model
training is <code dir="ltr" translate="no">train_spec.max_steps</code>. If <code dir="ltr" translate="no">train_spec.max_steps</code> is <code dir="ltr" translate="no">None</code>, the
model is trained forever. <em>Use with care</em> if model stop condition is
different. For example, assume that the model is expected to be trained with
one epoch of training data, and the training <code dir="ltr" translate="no">input_fn</code> is configured to throw
<code dir="ltr" translate="no">OutOfRangeError</code> after going through one epoch, which stops the
<a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/estimator/Estimator#train"><code dir="ltr" translate="no">Estimator.train</code></a>. For a three-training-worker distributed configuration, each
training worker is likely to go through the whole epoch independently. So, the
model will be trained with three epochs of training data instead of one epoch.</p>
<p>Example of local (non-distributed) training:</p>
<pre class="prettyprint lang-python" dir="ltr" translate="no"><code dir="ltr" translate="no"># Set up feature columns.
categorial_feature_a = categorial_column_with_hash_bucket(...)
categorial_feature_a_emb = embedding_column(
    categorical_column=categorial_feature_a, ...)
...  # other feature columns

estimator = DNNClassifier(
    feature_columns=[categorial_feature_a_emb, ...],
    hidden_units=[1024, 512, 256])

# Or set up the model directory
#   estimator = DNNClassifier(
#       config=tf.estimator.RunConfig(
#           model_dir=&#39;/my_model&#39;, save_summary_steps=100),
#       feature_columns=[categorial_feature_a_emb, ...],
#       hidden_units=[1024, 512, 256])

# Input pipeline for train and evaluate.
def train_input_fn(): # returns x, y
  # please shuffle the data.
  pass
def eval_input_fn(): # returns x, y
  pass

train_spec = tf.estimator.TrainSpec(input_fn=train_input_fn, max_steps=1000)
eval_spec = tf.estimator.EvalSpec(input_fn=eval_input_fn)

tf.estimator.train_and_evaluate(estimator, train_spec, eval_spec)
</code></pre>
<p>Note that in current implementation <code dir="ltr" translate="no">estimator.evaluate</code> will be called
multiple times. This means that evaluation graph (including eval_input_fn)
will be re-created for each <code dir="ltr" translate="no">evaluate</code> call. <code dir="ltr" translate="no">estimator.train</code> will be called
only once.</p>
<p>Example of distributed training:</p>
<p>Regarding the example of distributed training, the code above can be used
without a change (Please do make sure that the <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/RunConfig#model_dir"><code dir="ltr" translate="no">RunConfig.model_dir</code></a> for all
workers is set to the same directory, i.e., a shared file system all workers
can read and write). The only extra work to do is setting the environment
variable <code dir="ltr" translate="no">TF_CONFIG</code> properly for each worker correspondingly.</p>
<p>Also see
<a href="https://www.tensorflow.org/deploy/distributed">Distributed TensorFlow</a>.</p>
<p>Setting environment variable depends on the platform. For example, on Linux,
it can be done as follows (<code dir="ltr" translate="no">$</code> is the shell prompt):</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no">$ TF_CONFIG=&#39;&lt;replace_with_real_content&gt;&#39; python train_model.py
</code></pre>
<p>For the content in <code dir="ltr" translate="no">TF_CONFIG</code>, assume that the training cluster spec looks
like:</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no">cluster = {&#34;chief&#34;: [&#34;host0:2222&#34;],
           &#34;worker&#34;: [&#34;host1:2222&#34;, &#34;host2:2222&#34;, &#34;host3:2222&#34;],
           &#34;ps&#34;: [&#34;host4:2222&#34;, &#34;host5:2222&#34;]}
</code></pre>
<p>Example of <code dir="ltr" translate="no">TF_CONFIG</code> for chief training worker (must have one and only one):</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no"># This should be a JSON string, which is set as environment variable. Usually
# the cluster manager handles that.
TF_CONFIG=&#39;{
    &#34;cluster&#34;: {
        &#34;chief&#34;: [&#34;host0:2222&#34;],
        &#34;worker&#34;: [&#34;host1:2222&#34;, &#34;host2:2222&#34;, &#34;host3:2222&#34;],
        &#34;ps&#34;: [&#34;host4:2222&#34;, &#34;host5:2222&#34;]
    },
    &#34;task&#34;: {&#34;type&#34;: &#34;chief&#34;, &#34;index&#34;: 0}
}&#39;
</code></pre>
<p>Note that the chief worker also does the model training job, similar to other
non-chief training workers (see next paragraph). In addition to the model
training, it manages some extra work, e.g., checkpoint saving and restoring,
writing summaries, etc.</p>
<p>Example of <code dir="ltr" translate="no">TF_CONFIG</code> for non-chief training worker (optional, could be
multiple):</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no"># This should be a JSON string, which is set as environment variable. Usually
# the cluster manager handles that.
TF_CONFIG=&#39;{
    &#34;cluster&#34;: {
        &#34;chief&#34;: [&#34;host0:2222&#34;],
        &#34;worker&#34;: [&#34;host1:2222&#34;, &#34;host2:2222&#34;, &#34;host3:2222&#34;],
        &#34;ps&#34;: [&#34;host4:2222&#34;, &#34;host5:2222&#34;]
    },
    &#34;task&#34;: {&#34;type&#34;: &#34;worker&#34;, &#34;index&#34;: 0}
}&#39;
</code></pre>
<p>where the <code dir="ltr" translate="no">task.index</code> should be set as 0, 1, 2, in this example, respectively
for non-chief training workers.</p>
<p>Example of <code dir="ltr" translate="no">TF_CONFIG</code> for parameter server, aka ps (could be multiple):</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no"># This should be a JSON string, which is set as environment variable. Usually
# the cluster manager handles that.
TF_CONFIG=&#39;{
    &#34;cluster&#34;: {
        &#34;chief&#34;: [&#34;host0:2222&#34;],
        &#34;worker&#34;: [&#34;host1:2222&#34;, &#34;host2:2222&#34;, &#34;host3:2222&#34;],
        &#34;ps&#34;: [&#34;host4:2222&#34;, &#34;host5:2222&#34;]
    },
    &#34;task&#34;: {&#34;type&#34;: &#34;ps&#34;, &#34;index&#34;: 0}
}&#39;
</code></pre>
<p>where the <code dir="ltr" translate="no">task.index</code> should be set as 0 and 1, in this example, respectively
for parameter servers.</p>
<p>Example of <code dir="ltr" translate="no">TF_CONFIG</code> for evaluator task. Evaluator is a special task that is
not part of the training cluster. There could be only one. It is used for
model evaluation.</p>
<pre class="prettyprint" dir="ltr" translate="no"><code dir="ltr" translate="no"># This should be a JSON string, which is set as environment variable. Usually
# the cluster manager handles that.
TF_CONFIG=&#39;{
    &#34;cluster&#34;: {
        &#34;chief&#34;: [&#34;host0:2222&#34;],
        &#34;worker&#34;: [&#34;host1:2222&#34;, &#34;host2:2222&#34;, &#34;host3:2222&#34;],
        &#34;ps&#34;: [&#34;host4:2222&#34;, &#34;host5:2222&#34;]
    },
    &#34;task&#34;: {&#34;type&#34;: &#34;evaluator&#34;, &#34;index&#34;: 0}
}&#39;
</code></pre>
<p>When <code dir="ltr" translate="no">distribute</code> or <code dir="ltr" translate="no">experimental_distribute.train_distribute</code> and
<code dir="ltr" translate="no">experimental_distribute.remote_cluster</code> is set, this method will start a
client running on the current host which connects to the <code dir="ltr" translate="no">remote_cluster</code> for
training and evaluation.</p>
<h4 id="args">Args:</h4>
<ul>
<li><b><code dir="ltr" translate="no">estimator</code></b>: An <code dir="ltr" translate="no">Estimator</code> instance to train and evaluate.</li>
<li><b><code dir="ltr" translate="no">train_spec</code></b>: A <code dir="ltr" translate="no">TrainSpec</code> instance to specify the training specification.</li>
<li><b><code dir="ltr" translate="no">eval_spec</code></b>: A <code dir="ltr" translate="no">EvalSpec</code> instance to specify the evaluation and export
specification.</li>
</ul>
<h4 id="returns">Returns:</h4>
<p>A tuple of the result of the <code dir="ltr" translate="no">evaluate</code> call to the <code dir="ltr" translate="no">Estimator</code> and the
export results using the specified <code dir="ltr" translate="no">ExportStrategy</code>.
Currently, the return value is undefined for distributed training mode.</p>
<h4 id="raises">Raises:</h4>
<ul>
<li><b><code dir="ltr" translate="no">ValueError</code></b>: if environment variable <code dir="ltr" translate="no">TF_CONFIG</code> is incorrectly set.</li>
</ul>
</div>
<devsite-page-rating hover-rating-star="0" position="footer" selected-rating="0">
</devsite-page-rating>
</article>
</article>

</devsite-content>
</main>
<devsite-footer-promos class="devsite-footer">
</devsite-footer-promos>
<devsite-footer-linkboxes class="devsite-footer">

</devsite-footer-linkboxes>
<devsite-footer-utility class="devsite-footer">
<div class="devsite-footer-utility nocontent">

</div>
</devsite-footer-utility>
</section></section>
<devsite-sitemask></devsite-sitemask>
<devsite-snackbar></devsite-snackbar> <devsite-tooltip></devsite-tooltip>
<devsite-heading-link></devsite-heading-link>
<devsite-analytics>


</devsite-analytics>
 
</body></html>